"use strict";(self.webpackChunkfamily_doc_app=self.webpackChunkfamily_doc_app||[]).push([[8074],{45793:(e,l,s)=>{s.d(l,{Z:()=>n});var i=s(29086);const n=async e=>{try{const l=await i.Z.post("/digitalOcean/post",e);return null===l||void 0===l?void 0:l.data}catch(l){return l}}},35100:(e,l,s)=>{s.d(l,{Z:()=>a});s(72791);var i=s(36638),n=s(7692),o=s(80184);function a(e){let{onChange:l,...s}=e;return(0,o.jsxs)("div",{className:"position-relative me-2",children:[(0,o.jsx)(i.Z.Control,{onChange:l,type:"text",placeholder:"Search",className:"search-field-spacing ".concat(s.className),"aria-label":"Search"}),(0,o.jsx)(n.Goc,{size:22,className:"searchbar-icon"})]})}},15626:(e,l,s)=>{s.d(l,{Z:()=>n});var i=s(72791);const n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;const[l,s]=(0,i.useState)(""),n=(0,i.useRef)(null);return[l,(0,i.useCallback)((l=>{n.current&&clearTimeout(n.current),n.current=setTimeout((()=>{n.current=null,s(l.target.value)}),e)}),[e])]}},78074:(e,l,s)=>{s.r(l),s.d(l,{default:()=>_});var i=s(72791),n=s(95070),o=s(47022),a=s(89743),t=s(2677),d=s(36638),c=s(43360),r=s(59434),m=s(72426),u=s.n(m),v=s(76053),x=s(78820),f=s(56355),h=s(39126),g=s(23853),j=s(76421),p=s(10857),N=s(83086),b=s(73683),y=s(66791),W=s(15626),I=s(45793),w=s(35100),U=s(80184);const _=()=>{const e=(0,i.useRef)(null),l=(0,i.useRef)(null),[s,m]=(0,i.useState)(""),[_,C]=(0,i.useState)(),[D,k]=(0,i.useState)(!1),[Z,F]=(0,i.useState)(null),[E,S]=(0,i.useState)(null),[z,M]=(0,W.Z)(500),T=(0,r.I0)(),{user:Y}=(0,r.v9)((e=>e.auth)),{allInboxList:A,allMessages:B,isLoadingAllInboxList:L,isSuccessAllInboxList:P,isErrorAllInboxList:O}=(0,r.v9)((e=>null===e||void 0===e?void 0:e.chat)),R=null===Y||void 0===Y?void 0:Y.userId;(0,i.useEffect)((()=>(y.W&&(null===y.W||void 0===y.W||y.W.on("connect",(()=>{console.log("signal1",null===y.W||void 0===y.W?void 0:y.W.connected)})),null===y.W||void 0===y.W||y.W.emit("connectToUserRoom",{userId:R},(()=>{console.log("signal2",null===y.W||void 0===y.W?void 0:y.W.connected)})),null!==y.W&&void 0!==y.W&&y.W.connected||null===y.W||void 0===y.W||y.W.on("reconnect",(()=>{console.log("reconnect",null===y.W||void 0===y.W?void 0:y.W.connected)})),null!==y.W&&void 0!==y.W&&y.W.connected&&console.log("refttytfconnect",null===y.W||void 0===y.W?void 0:y.W.connected),y.W.on("disconnect",(()=>{console.log("Disconnected")}))),()=>{y.W.off("connect"),y.W.off("connected"),y.W.off("disconnect"),y.W.off("messageData")})),[R,y.W]),(0,i.useEffect)((()=>{const e=e=>{if(null!==e&&void 0!==e&&e.data){var l;const s=null===e||void 0===e||null===(l=e.data)||void 0===l?void 0:l.data,i=JSON.parse(s),n={createdDate:(0,b.oA)(new Date),file:null!==i&&void 0!==i&&i.file?null===i||void 0===i?void 0:i.file:null,fileUrl:null!==i&&void 0!==i&&i.fileUrl?null===i||void 0===i?void 0:i.fileUrl:null,fromUserId:null===i||void 0===i?void 0:i.fromUserId,fromUserName:null!==i&&void 0!==i&&i.fromUserName?null===i||void 0===i?void 0:i.fromUserName:null!==_&&void 0!==_&&_.userName?null===_||void 0===_?void 0:_.userName:null,image:null!==i&&void 0!==i&&i.image?null===i||void 0===i?void 0:i.image:null,imageUrl:null!==i&&void 0!==i&&i.imageUrl?null===i||void 0===i?void 0:i.imageUrl:null,inboxId:null===i||void 0===i?void 0:i.inboxId,message:null===i||void 0===i?void 0:i.message,messageId:null!==i&&void 0!==i&&i.messageId?null===i||void 0===i?void 0:i.messageId:null,toUserId:null===i||void 0===i?void 0:i.toUserId,toUserName:null!==i&&void 0!==i&&i.toUserName?null===i||void 0===i?void 0:i.toUserName:null};T((0,N.FT)(n))}};return null!==y.W&&void 0!==y.W&&y.W.connected&&y.W.on("messageData",e),()=>{y.W.off("messageData",e)}}),[y.W,_]);const H=e=>{y.W.emit("sendMessage",{userIds:[{id:null===_||void 0===_?void 0:_.userId}],data:JSON.stringify(null===e||void 0===e?void 0:e.data)})},G=e=>{e.preventDefault();const l={inboxId:null===_||void 0===_?void 0:_.inboxId,fromUserId:null===Y||void 0===Y?void 0:Y.userId,toUserId:null===_||void 0===_?void 0:_.userId,message:s.trim()||"",file:(null===E||void 0===E?void 0:E.keyName)||"",fileUrl:(null===E||void 0===E?void 0:E.baseUrl)||"",isChat:!0};T((0,N.bG)({finalData:l,moveToNext:H})),m(""),F(null),S(null)};(0,i.useEffect)((()=>{const e={inboxId:null===_||void 0===_?void 0:_.inboxId};T((0,N.SO)(e))}),[T,null===_||void 0===_?void 0:_.inboxId]),(0,i.useEffect)((()=>{const e={search:z||null};T((0,N.VH)(e))}),[T,z]),(0,i.useEffect)((()=>{var l;null===(l=e.current)||void 0===l||l.scrollIntoView({behavior:"smooth"})}),[B]);const K=e=>{"Enter"===e.key&&(e.preventDefault(),(""!==s.trim()||null!==E&&void 0!==E&&E.keyName)&&G(e))};return(0,i.useEffect)((()=>{const e=l.current;return e&&e.addEventListener("keydown",K),()=>{e&&e.removeEventListener("keydown",K)}}),[]),(0,U.jsx)(U.Fragment,{children:(0,U.jsx)(n.Z,{className:"h-100 chatSection",children:(0,U.jsx)(n.Z.Body,{className:"py-0 px-0",children:(0,U.jsx)(o.Z,{fluid:!0,children:(0,U.jsxs)(a.Z,{className:"staff-chat w-100",children:[(0,U.jsxs)(t.Z,{xl:4,lg:12,md:12,className:"p-4 borderRight paddingBottom chat-box-shadow-lt",children:[(0,U.jsx)("h3",{className:"fw-bold mb-3",children:"Messages"}),(0,U.jsx)(w.Z,{onChange:M}),L?(0,U.jsx)("p",{className:"my-5 text-center fst-italic",style:{color:"#999999"},children:"Loading..."}):P?(0,U.jsx)("div",{className:"staff-inbox",children:null===A||void 0===A?void 0:A.map((e=>{let l=u()(u().utc(null===e||void 0===e?void 0:e.createdDate).toDate()).local(!0).format("h:mm a");return(0,U.jsxs)("div",{className:"userChat p-1 mt-1 mobileFlex_reverse d-flex justify-content-between align-items-center ".concat(_&&_.inboxId===e.inboxId?"activeChat":"hoverChat"),onClick:()=>(e=>{C(e),m(""),F(null);const l={inboxId:(null===e||void 0===e?void 0:e.inboxId)||(null===_||void 0===_?void 0:_.inboxId)};T((0,N.Fd)(l))})(e),children:[(0,U.jsxs)("div",{className:"d-flex mobileFlex_between align-items-center",children:[(0,U.jsx)("span",{children:(0,U.jsx)("img",{className:"w-25 rounded-circle",src:e.imageUrl?e.imageUrl:"https://ui-avatars.com/api/?name=".concat("".concat(e.userName),"&background=000071&color=fff"),alt:"UserImage"})}),(0,U.jsxs)("div",{className:"d-flex flex-column align-items-start ms-3 mt-2",children:[(0,U.jsx)("h5",{className:"mb-1 fw-semibold mobileTextHeading ",children:e.userName?e.userName:"N/A"}),(0,U.jsx)("p",{className:"w-auto color_light mobileText m-0 message-container",children:e.message?e.message:""})]})]}),(0,U.jsxs)("div",{className:"d-flex flex-column justify-content-center align-items-end",children:[(0,U.jsx)("p",{className:"color_light fs-6 mb-1",children:l}),e.unreadCount>0&&(0,U.jsx)("span",{className:"chatCount text-white rounded",children:e.unreadCount})]})]},e.inboxId)}))}):O?(0,U.jsx)("p",{className:"my-5 text-center text-danger fst-italic",children:"Network Error"}):null]}),(0,U.jsx)(t.Z,{xl:8,lg:12,md:12,className:"px-0 chatContent chat-box-shadow-rt",children:_?(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)("div",{className:"d-flex justify-content-between mobileFlex_Col py-2 border-bottom px-4 ",children:(0,U.jsx)("div",{className:"d-flex justify-content-center align-items-center chatActive mb-sm-0 mb-3",children:(0,U.jsxs)("div",{className:"d-flex align-items-center py-0",children:[(0,U.jsx)("span",{children:(0,U.jsx)("img",{className:"rounded-circle",src:_.imageUrl?_.imageUrl:"https://ui-avatars.com/api/?name=".concat("".concat(_.userName),"&background=000071&color=fff"),alt:"UserImage"})}),(0,U.jsx)("h5",{className:"fw-semibold mb-0 ms-3 mobileTextHeading",children:_.userName})]})})}),(0,U.jsxs)("div",{children:[(0,U.jsx)("div",{className:"div-fixed-height",style:{background:"#FBFBFB"},children:null!==B?null===B||void 0===B?void 0:B.map(((l,s)=>{var i,n,o,d,c,r,m,v,x,g,j;let N=u()(u().utc(null===l||void 0===l?void 0:l.createdDate).toDate()).local(!0).format("h:mm a");return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)("div",{className:"d-flex flex-column h-100 px-4 py-3 chatBox",children:(0,U.jsxs)("div",{children:[(null===B||void 0===B||null===(i=B[s-1])||void 0===i||null===(n=i.createdDate)||void 0===n||null===(o=n.split("T"))||void 0===o?void 0:o[0])!==(null===l||void 0===l||null===(d=l.createdDate)||void 0===d||null===(c=d.split("T"))||void 0===c?void 0:c[0])&&(0,U.jsx)("div",{className:"text-center rounded-pill mx-auto chatSpan bg-white",children:u()(null===l||void 0===l?void 0:l.createdDate).format("DD-MM-YYYY")===u()(new Date).format("DD-MM-YYYY")?"Today":u()(null===l||void 0===l?void 0:l.createdDate).format("DD-MM-YYYY")}),(0,U.jsx)("div",{children:(0,U.jsx)(a.Z,{children:(null===l||void 0===l?void 0:l.fromUserId)!==(null===Y||void 0===Y?void 0:Y.userId)?(0,U.jsx)(t.Z,{lg:8,md:6,children:(0,U.jsxs)("div",{className:"chatMessage_left d-flex justify-content-start mobileFlex_Col mb-1",children:[(0,U.jsx)("img",{className:"me-2 mb-2 mb-sm-0 rounded-circle",style:{width:"50px",height:"50px"},src:null!==l&&void 0!==l&&l.imageUrl?null===l||void 0===l?void 0:l.imageUrl:"https://ui-avatars.com/api/?name=".concat(null===l||void 0===l?void 0:l.fromUserName,"&background=000071&color=fff"),alt:"UserImage"}),(0,U.jsxs)("div",{className:"w-100",children:[(null===l||void 0===l?void 0:l.file)&&(0,U.jsx)("div",{className:"chat__upload-doc",style:{width:"40%"},children:(0,U.jsxs)("a",{href:null===l||void 0===l?void 0:l.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"text-decoration-none",children:[(0,U.jsxs)("div",{className:"d-flex align-items-center p-2 border-bottom",children:[null!==l&&void 0!==l&&null!==(r=l.file)&&void 0!==r&&r.endsWith(".pdf")?(0,U.jsx)(f.B$y,{size:22,color:"#BC0613"}):(0,U.jsx)(h.jnY,{size:22,color:"#000071"}),(0,U.jsx)("label",{className:"chat__upload_text px-2 fw-bold",children:null===l||void 0===l?void 0:l.file})]}),(0,U.jsx)("img",{className:"rounded\n                                                        ".concat(null!==l&&void 0!==l&&null!==(m=l.file)&&void 0!==m&&m.endsWith(".pdf")?"object-fit-contain":"object-fit-cover"),width:"100%",height:"76%",src:null!==l&&void 0!==l&&null!==(v=l.file)&&void 0!==v&&v.endsWith(".pdf")?p.Z.PDF_DOC:null===l||void 0===l?void 0:l.fileUrl,alt:"doc"})]})}),(null===l||void 0===l?void 0:l.message)&&(0,U.jsx)("div",{className:"messageSpan",children:null===l||void 0===l?void 0:l.message}),N&&(0,U.jsx)("div",{className:"chatTime",children:N})]})]})}):(0,U.jsxs)(t.Z,{lg:4,md:6,className:"chatMessage_right text-white d-flex flex-column align-items-end justify-content-end w-100",children:[(null===l||void 0===l?void 0:l.file)&&(0,U.jsx)("div",{className:"chat__upload-doc",children:(0,U.jsxs)("a",{href:null===l||void 0===l?void 0:l.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"text-decoration-none",children:[(0,U.jsxs)("div",{className:"d-flex align-items-center p-2 border-bottom",children:[null!==l&&void 0!==l&&null!==(x=l.file)&&void 0!==x&&x.endsWith(".pdf")?(0,U.jsx)(f.B$y,{size:22,color:"#BC0613"}):(0,U.jsx)(h.jnY,{size:22,color:"#000071"}),(0,U.jsx)("label",{className:"chat__upload_text px-2 fw-bold",children:null===l||void 0===l?void 0:l.file})]}),(0,U.jsx)("img",{className:"rounded\n                                                        ".concat(null!==l&&void 0!==l&&null!==(g=l.file)&&void 0!==g&&g.endsWith(".pdf")?"object-fit-contain":"object-fit-cover"),width:"100%",height:"76%",src:null!==l&&void 0!==l&&null!==(j=l.file)&&void 0!==j&&j.endsWith(".pdf")?p.Z.PDF_DOC:null===l||void 0===l?void 0:l.fileUrl,alt:"doc"})]})}),(null===l||void 0===l?void 0:l.message)&&(0,U.jsx)("span",{className:"mb-1 mobile_margin sender-message",children:null===l||void 0===l?void 0:l.message}),N&&(0,U.jsx)("div",{className:"chatTime align-self-end",children:N})]})})})]})}),(0,U.jsx)("div",{ref:e})]})})):"No Message"}),(0,U.jsxs)("div",{className:"border-top",children:[(0,U.jsxs)("div",{className:"d-flex mobileFlex_Col justify-content-between align-items-center px-sm-4",children:[(0,U.jsxs)("div",{className:"d-flex justify-content-center align-items-center position-relative",children:[(0,U.jsx)(f.sr,{size:28,color:D?"#000071":"#A8A8A8",className:"text-cursor-pointer",onClick:()=>k((e=>!e))}),D&&(0,U.jsx)(j.ZP,{lazyLoadEmojis:!0,onEmojiClick:e=>{m((l=>l+(null===e||void 0===e?void 0:e.emoji))),k(!1)},className:"position-absolute",style:{top:"-27.5rem",left:0}}),(0,U.jsx)("div",{className:"mx-3",children:(0,U.jsx)("label",{htmlFor:"file-upload",className:"text-center",children:(0,U.jsx)(g.UH,{size:26,color:"#A8A8A8",className:"text-cursor-pointer"})})}),(0,U.jsx)("input",{size:"small",type:"file",id:"file-upload",name:"file-upload",accept:"image/png, image/jpeg, application/pdf",onChange:e=>(async e=>{let l=e.target.files[0];if(F(l),l){const e=l.name.lastIndexOf("."),s=l.name.slice(0,e),i=l.name.slice(e+1,l.name.length);if("pdf"===i.toLowerCase()){const e=new FileReader;e.onload=async e=>{const l=e.target.result,n={name:s,base64:l.split(",")[1],fileExtension:"".concat(i)};(0,I.Z)(n).then((e=>{null!==e&&void 0!==e&&e.keyName?(S(e),(0,b.P_)("File uploaded.",!0)):(0,b.P_)("File too large. Max size is 500KB.",!1)}))},e.onerror=e=>{console.log("error",e)},e.readAsDataURL(l)}else(0,b.ZP)(l).then((e=>{const l={name:s,base64:e,fileExtension:"".concat(i)};(0,I.Z)(l).then((e=>{null!==e&&void 0!==e&&e.keyName?(S(e),(0,b.P_)("File uploaded.",!0)):(0,b.P_)("File too large. Max size is 750KB.",!1)}))}))}})(e),className:"upload-file"})]}),(0,U.jsx)("div",{className:"w-100 d-flex miniFlex_Col",children:(0,U.jsxs)(d.Z.Group,{className:"position-relative my-3 w-100",children:[(0,U.jsx)(d.Z.Control,{as:"textarea",rows:1,className:"padding rounded-pill",placeholder:"Type a message here\u2026",value:s,onChange:e=>m(e.target.value),ref:l,onKeyDown:K,style:{resize:"none"}}),(0,U.jsx)(c.Z,{className:"sendIcon rounded-circle",onClick:G,disabled:""===s.trim()&&!(null!==E&&void 0!==E&&E.keyName),children:(0,U.jsx)("img",{src:p.Z.SEND_ICON,alt:"messageIcon"})})]})})]}),(null===Z||void 0===Z?void 0:Z.name)&&(0,U.jsxs)("div",{className:"d-flex align-items-center pb-2",style:{marginLeft:"7.5rem"},children:[(0,U.jsx)(v.hF6,{size:25,style:{color:"#000071"}}),(0,U.jsx)("h6",{className:"file-name mb-0 ms-2",children:null===Z||void 0===Z?void 0:Z.name}),(0,U.jsx)("span",{className:"mx-3 text-cursor-pointer",children:(0,U.jsx)(x.oHP,{size:18,onClick:()=>{F(null),S(null),document.getElementById("file-upload").value=null}})})]})]})]})]}):(0,U.jsxs)("h5",{className:"mb-0 text-center text-black-50 d-flex justify-content-center align-items-center h-100",children:["Welcome to our chat system ",(0,U.jsx)("br",{})," Please feel free to start typing your message"]})})]})})})})})}}}]);
//# sourceMappingURL=8074.f322b412.chunk.js.map